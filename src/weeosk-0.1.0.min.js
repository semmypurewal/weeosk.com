function init(){window.ac=new ApplicationController()}function ApplicationController(){var a=this;this.svc=new SearchViewController($("#SearchView"));this.wvc=new WeeoskViewController($("#WeeoskView"));this.visibleController=this.svc;$("#go_button").click(function(){a.go(document.getElementById("search_term_input").value)});$("#restart_button").click(function(){a.toggle()});$("#search_term_input").keydown(function(b){if(b.keyCode===13){a.go(document.getElementById("search_term_input").value)}})}ApplicationController.prototype.go=function(a){var b=this;if(a!==""){this.wvc.setSearchTerm(a);b.toggle()}};ApplicationController.prototype.toggle=function(){var a=this;this.visibleController.hide();setTimeout(function(){if(a.visibleController===a.svc){a.wvc.show();a.visibleController=a.wvc}else{a.visibleController=a.svc;a.svc.show()}},1000)};function SearchViewController(b){var a;this.view=b;document.getElementById("search_term_input").value="";this.show();a=new spotter.Spotter("twitter.trends",{frequency:0});a.register(this);a.spot()}SearchViewController.prototype.show=function(){this.view.fadeIn(500)};SearchViewController.prototype.hide=function(){this.view.fadeOut(500)};SearchViewController.prototype.notify=function(b){var a;$("#trends").append("<p id='trends1'>");for(t in b.trends.slice(0,5)){if(t!=="4"){$("#trends1").append("<a class='trend' href='#' onclick='window.ac.go(\""+b.trends[t].name+"\");'>"+b.trends[t].name+"</a>, ")}else{$("#trends1").append("<a class='trend' href='#' onclick='window.ac.go(\""+b.trends[t].name+"\");'>"+b.trends[t].name+"</a>")}}$("#trends").append("<p id='trends2'>");var a=b.trends.slice(5,10);for(t in a){if(t!=="4"){$("#trends2").append("<a class='trend' href='#' onclick='window.ac.go(\""+a[t].name+"\");'>"+a[t].name+"</a>, ")}else{$("#trends2").append("<a class='trend' href='#' onclick='window.ac.go(\""+a[t].name+"\");'>"+a[t].name+"</a>")}}$("#trends").fadeIn("slow")};function WeeoskViewController(a){var b=this;this.view=a;this.controlTimeout=null;a.mousemove(function(){b.showControls()})}WeeoskViewController.prototype.show=function(){this.view.fadeIn(500);this.showControls();$("#weeosk_item0").html("<div class='flickr'><div class='image'><img class='weeosk_image' src='images/loading.gif'></img></div></div>");$("#weeosk_item0").show();var a=$("#weeosk_item0");var b=0.5*($("#display_area").height()-a.height());a.css({position:"relative",top:b+"px"});$("#weeosk_item1").hide();this.wc=new WeeoskController(this.searchTerm)};WeeoskViewController.prototype.showControls=function(){var a=this;$("#controls").fadeIn();$("#weeosk_term").fadeIn();if(this.controlTimeout!==null){clearTimeout(this.controlTimeout)}this.controlTimeout=setTimeout(function(){a.hideControls()},2000)};WeeoskViewController.prototype.hideControls=function(){$("#controls").fadeOut()};WeeoskViewController.prototype.hide=function(){this.view.fadeOut(500);this.wc.destroy();$("#weeosk_item0").html("");$("#weeosk_item1").html("")};WeeoskViewController.prototype.setSearchTerm=function(a){$("#weeosk_term").text(a);this.searchTerm=a};function WeeoskController(c){if(c===null||c===undefined||c===""){throw new Error("undefined search term Weeosk")}var e=this;var f=new Weeosk();var a=null;var h=500;var i=6000;var b=[];var d=0;b.push(new TwitterController("twitter.search",{searchString:c,frequency:60},f));b.push(new FlickrController("flickr.feeds",{tags:c,frequency:60},f));b.push(new TwitpicController("twitpic.search",{searchString:c,frequency:60},f));this.destroy=function(){clearTimeout(a);for(var j in b){b[j].destroy()}setTimeout(function(){$("#weeosk_item0").html("")},1000)};this.play=function(){if(!f.ready()){setTimeout(function(){e.play()},500)}else{$("#weeosk_item"+(d+1)%2).html(f.currentItem());a=setInterval(function(){e.display()},i)}};this.stop=function(){a=null};this.display=function(){$("#weeosk_item"+d).fadeOut(h,function(){d=(d+1)%2;$("#weeosk_item"+(d+1)%2).html(f.currentItem());var o=new Date($("#weeosk_item"+d+" .timestamp").html());var l=new Date();var j=g((l.getTime()-o.getTime())/1000);if(j!==""){$("#weeosk_item"+d+" .relative_timestamp").html(j)}else{$("#weeosk_item"+d+" .relative_timestamp").html(o.toLocaleString())}$("#weeosk_item"+d).fadeIn(h);var k=$("#display_area");var n=$("#weeosk_item"+d+" img.weeosk_image");if(n.width()!==null){var q=(n.width()/n.height()>k.width()/k.height())?"width":"height";var m=Math.ceil(k[q]()*0.8);n[q](m+"px")}var n=$("#weeosk_item"+d);var p=0.5*(k.height()-n.height());n.css({position:"relative",top:p+"px"})})};var g=function(k){var j;if(!k){j=""}else{if(k<60){j="about "+Math.round(k)+" seconds ago"}else{if(k<3600){j="about "+Math.round(k/60)+" minutes ago"}else{if(k<86400){j="about "+Math.round(k/3600)+" hours ago"}else{if(k<604800){j=Math.round(k/86400)+" days ago"}else{if(k<4233600){j=Math.round(k/604800)+" weeks ago"}else{j=""}}}}}}j=j.replace(new RegExp("(( |^)1 \\S*)s ","g"),"$1 ");return j};this.play()}function Weeosk(h){var b=10;var a={};var g={};var f=0;var e=null;var d=null;var c=false;this.add=function(i){var j=i[0];var k=i[1];if(a[j]===undefined){a[j]=[];f=f+1}a[j].unshift(k);g[j]=0;if(!c){c=true}if(a[j].length>b){a[j].pop()}};this.currentItem=function(){var l=Math.floor(Math.random()*f);var m;var j;for(var k in a){if(l===0){m=k}l--}j=a[m][g[m]];g[m]=(g[m]+1)%a[m].length;return j};this.ready=function(){return c}}SpotterController=function(c,a,d){var b=new spotter.Spotter(c,a);this.notify=function(g){for(var f=g.length-1;f>=0;f--){var e=this.markup(g[f]);d.add([c.split(".")[0],e])}};this.markup=function(e){throw new Error("markup not implemented in the generic SpotterController class")};this.destroy=function(){b.stop()};b.register(this);b.spot();this.tweetLinkify=function(e){e=e.replace(new RegExp("(http:/\\S*)","g"),'<a target ="_blank" href="$1">$1</a>');e=e.replace(new RegExp("(^| )@(\\S+)","g"),"<a target='_blank' href='http://www.twitter.com/$2'>@$2</a>");return e}};TwitterController=function(b,a,c){SpotterController.call(this,b,a,c);this.markup=function(e){var d="<div class='twitter'><div class='text'>"+this.tweetLinkify(e.text)+"</div><div class='user_id'><a target='_blank' href='http://www.twitter.com/"+e.from_user+"'>"+e.from_user+"</a> <span class='additional_info'><span class='relative_timestamp'></span> via&nbsp;<a target='_blank' href='http://www.twitter.com'>twitter</a></span></div><div class='profile_image'><img src='"+e.profile_image_url+"'></img></div><div class='timestamp' style='display:none'>"+e.created_at+"</div></div>";return d}};FlickrController=function(b,a,c){SpotterController.call(this,b,a,c);this.markup=function(f){var e=f.published.split(new RegExp("[-T:Z]"));var g=new Date(e[0],e[1]-1,e[2]-1,e[3],e[4],e[5]);var d="<div class='flickr'><div  class='image'><a target='_blank' href='"+f.photo_url+"'><img class='weeosk_image' src='"+f.url+"'></a></img></div><div class='title'>"+f.title+"</div><div class='user_id'><a target='_blank' href='"+f.user_url+"'>"+f.user_id+"</a> <span class='additional_info'><span class='relative_timestamp'></span> via&nbsp;<a target='_blank' href='http://www.flickr.com'>flickr</a></span></div><div class='timestamp' style='display:none'>"+g.toUTCString()+"</div></div>";return d}};TwitpicController=function(b,a,c){SpotterController.call(this,b,a,c);this.markup=function(e){var f=e.text.match(new RegExp("http://twitpic.com/\\S*","g"),"")[0];e.text=e.text.replace(f,"");var d="<div class='twitpic'><div class='profile_image'><img src='"+e.profile_image_url+"'></img></div><div class='image'><a target='_blank' href='"+f+"'><img class='weeosk_image' src='"+e.twitpic_full_url+"'></img></a></div><div class='text'>"+this.tweetLinkify(e.text)+"</div><div class='user_id'><a target='_blank' href='http://www.twitter.com/"+e.from_user+"'>"+e.from_user+"</a> <span class='additional_info'><span class='relative_timestamp'></span> via&nbsp;<a target='_blank' href='http://www.twitpic.com'>twitpic</a></span></div><div class='timestamp' style='display:none'>"+e.created_at+"</div></div>";return d}};